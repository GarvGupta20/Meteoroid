os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - wget https://qwertyuiop1379.github.io/iPhoneOS11.2.sdk.zip
  - git clone --recursive git://github.com/theos/theos.git ~/theos
  - unzip iPhoneOS11.2.sdk.zip -d ~/theos/sdks/iPhoneOS11.2.sdk
script:
  - "export SYSROOT=~/theos/sdks/iPhoneOS11.2.sdk/"
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.com"
  - git tag -a v$VERSION -m "$DESCRIPTION"
deploy:
  provider: releases
  api_key:
    secure: sClwk2CM9WmAk242k51fmB4CznyOLnhqTKBoEASDhM8Z8aEvrNq/u7zMrS9enk9MS9ekCTK9GB4mf67FOTJAG7OXr0yIEkds00aaoWtE94X+dgqgIdsINpaHyh8Bb84Lwj/1gMxbH9KyrrQ9nXwNwIUkcoLSXmGDkKEyuXtPXFwiEeHs9kSCt6D0hOhPaF0uLVzsKN3HVq/0lX5CMu/e2TcQuxhoOUAHHO5CfdaV6IH+WBcXejkaNv8PXqOWxbSTmXU3ISaC/EfNxnWfeT/Q6opbkVZoy4dl/DG8V3j3xnIylaG0P89CrYcISqFMhvtHZOBsM5vtmZPQiUlHebX/4rytJsst8oPud7LoyuEtQDX0ER3jGR1Nr7QCwI8A7ciD0TrmqcnJ//wlr6ko2HJTNkPCAn/7d97Ml+n+hBiipSLyLp7sDZ2TkIN0orj7e73tnvLQ2aB9IFITTBQx6nYVkaB2dIrFtGHfHOGb6SPIJq0LNBLvTMv99+FpU32dwW1ci+RralF2bBPxdCOlVZAT6DydgDDfSPJB00pSCBDjQ2KD3tjRG4enCw0jD08/wPBtGP+gomQUCNjhdKtnSw+3mAAXlMd0K4Xn1LZJe00Ox/ulpGZNZ/xr/g1jD/lKlzkF4d2BPCuDgqZwR4p7Vperw/9hXXC93quNGNu+kMzX3xE=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - master
branches:
  except:
  - /^untagged/
